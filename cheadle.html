<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yardage Book ‚Äì Cheadle GC</title>

<link rel="icon" href="skratch.png" type="image/png">
<link rel="apple-touch-icon" href="skratch.png" sizes="180x180">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Yardage Book">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
:root{
  --accent:#007AFF;
  --bg:#f5f6f7;
  --card:rgba(255,255,255,0.88);
  --border:rgba(0,0,0,0.08);
  --text:#1d1d1f;
  --muted:#6e6e73;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:1rem;
  padding-bottom:8rem;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display","Helvetica Neue",Helvetica,Arial,sans-serif;
  color:var(--text);
}

h1{
  text-align:center;
  font-size:1.6rem;
  font-weight:700;
  margin:.5rem 0 .25rem;
}

.card{
  background:var(--card);
  backdrop-filter:blur(14px);
  border:1px solid var(--border);
  border-radius:16px;
  padding:1rem;
  margin:.75rem auto;
  max-width:420px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
}

#yardageStatusTop,
#compassStatus{
  text-align:center;
  font-weight:700;
  color:var(--muted);
  margin:.25rem auto;
}

#map{
  height:320px;
  border-radius:18px;
  border:1px solid var(--border);
  margin:1rem auto;
  max-width:420px;
}

select,button{
  width:100%;
  padding:.75rem 1rem;
  border-radius:14px;
  font-size:1rem;
  font-weight:600;
  border:1px solid var(--border);
}

button{
  background:var(--accent);
  color:white;
  border:none;
  box-shadow:0 6px 16px rgba(0,122,255,.35);
  margin-top:.5rem;
}

button.secondary{
  background:white;
  color:var(--accent);
  box-shadow:none;
}

#distanceDisplay{
  text-align:center;
  font-size:1.3rem;
  font-weight:700;
}

#clubSuggestion{
  text-align:center;
  font-weight:700;
  color:var(--accent);
}

#headingLabel{
  text-align:center;
  font-size:.95rem;
  color:var(--muted);
  display:none;
}

#weatherBox{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:.75rem;
}

#weatherBox img{
  width:54px;
  height:54px;
}

/* Footer */
.footerBar{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(14px);
  border-top:1px solid var(--border);
  padding:.75rem;
}

.footerInner{max-width:420px;margin:auto;text-align:center}

.footerActions{
  display:flex;
  justify-content:center;
  gap:.6rem;
}

.footerActions button{
  width:auto;
  padding:.55rem .9rem;
  border-radius:999px;
}

.footerText{
  font-size:.75rem;
  color:var(--muted);
  margin-top:.5rem;
}

/* Arrow markers */
.arrowBubble{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  width: auto !important;
  height: auto !important;
  border-radius: 0 !important;
  padding: 0 !important;

  color: #007AFF;
  font-size: 24px;
  font-weight: 900;
  line-height: 1;
}
.leaflet-div-icon{
  background: transparent !important;
  border: none !important;
}
</style>
</head>

<body>

<h1>Yardage Book</h1>
<div id="yardageStatusTop">Club Yardages: Not loaded</div>
<div id="compassStatus">Compass: Off</div>

<div id="weatherBox" class="card">Loading weather‚Ä¶</div>

<div id="map"></div>

<div class="card">
  <select id="holeSelect" onchange="showHoleLayout()">
    <option value="">Select Hole</option>
    <option value="1">Hole 1</option>
    <option value="2">Hole 2</option>
    <option value="3">Hole 3</option>
    <option value="4">Hole 4</option>
    <option value="5">Hole 5</option>
    <option value="6">Hole 6</option>
    <option value="7">Hole 7</option>
    <option value="8">Hole 8</option>
    <option value="9">Hole 9</option>
  </select>

  <div id="distanceDisplay">Distance: --</div>
  <div id="clubSuggestion">Suggested Club: --</div>
  <div id="headingLabel">You‚Äôre pointing: --</div>

  <button class="secondary" onclick="openYardageSheet()">üìä View Yardages</button>
</div>

<input type="file" id="yardageFile" accept=".json" hidden>

<!-- Footer -->
<div class="footerBar">
  <div class="footerInner">
    <div class="footerActions">
      <button class="secondary" onclick="yardageFile.click()">‚ûï</button>
      <button class="secondary" onclick="clearYardageBook()">üóëÔ∏è</button>
      <button class="secondary" onclick="toggleCompass()">üß≠</button>
    </div>
    <div class="footerText">Powered by ForeThought.site ‚Ä¢ An Apple Geek Product</div>
  </div>
</div>

<!-- Yardage Sheet -->
<div id="yardageSheet" style="position:fixed;inset:0;display:none;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);align-items:flex-end;justify-content:center;">
  <div style="background:white;border-radius:20px 20px 0 0;width:100%;max-width:420px;padding:1rem">
    <div style="display:flex;justify-content:space-between">
      <strong>Yardages</strong>
      <button class="secondary" onclick="closeYardageSheet()">Done</button>
    </div>
    <div id="yardageList"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ---------- Map Layers ---------- */
let map=L.map("map").setView([53.387,-2.205],17);

const street=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19});
const satellite=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19});

street.addTo(map);
L.control.layers({"Map":street,"Satellite":satellite}).addTo(map);

/* ---------- Hole Data ---------- */
const yardageData={
 "1":{whiteTee:{lat:53.388113,lng:-2.2067},green:{lat:53.385712,lng:-2.205569}},
 "2":{whiteTee:{lat:53.386272,lng:-2.205266},green:{lat:53.385069,lng:-2.206453}},
 "3":{whiteTee:{lat:53.386122,lng:-2.206867},green:{lat:53.383919,lng:-2.204562}},
 "4":{whiteTee:{lat:53.384254,lng:-2.20314},green:{lat:53.387625,lng:-2.202824}},
 "5":{whiteTee:{lat:53.38782,lng:-2.202718},green:{lat:53.387667,lng:-2.203872}},
 "6":{whiteTee:{lat:53.388148,lng:-2.203193},green:{lat:53.384237,lng:-2.203861}},
 "7":{whiteTee:{lat:53.384161,lng:-2.204177},green:{lat:53.385387,lng:-2.205308}},
 "8":{whiteTee:{lat:53.38418,lng:-2.204066},green:{lat:53.387473,lng:-2.20485}},
 "9":{whiteTee:{lat:53.387703,lng:-2.204087},green:{lat:53.387958,lng:-2.206264}}
};

/* ---------- Icons ---------- */
const teeIcon=L.divIcon({html:`<div class="arrowBubble">üìç</div>`,iconSize:[24,24],iconAnchor:[12,12]});
const greenIcon=L.divIcon({html:`<div class="arrowBubble">‚õ≥Ô∏è</div>`,iconSize:[24,24],iconAnchor:[12,12]});

let teeMarker,greenMarker,holeLine,userMarker;

/* ---------- GPS ---------- */
navigator.geolocation.watchPosition(p=>{
  const {latitude,longitude}=p.coords;
  userMarker?userMarker.setLatLng([latitude,longitude]):
    userMarker=L.marker([latitude,longitude]).addTo(map);
  showHoleLayout();
});

/* ---------- Distance ---------- */
function getDistance(a,b){
  const R=6371e3,toRad=x=>x*Math.PI/180;
  const dLat=toRad(b.lat-a.lat),dLon=toRad(b.lng-a.lng);
  const aa=Math.sin(dLat/2)**2+Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*Math.sin(dLon/2)**2;
  return R*(2*Math.atan2(Math.sqrt(aa),Math.sqrt(1-aa)));
}

/* ---------- Draw Hole ---------- */
function showHoleLayout(){
  const h=holeSelect.value;
  if(!h||!yardageData[h]||!userMarker)return;

  if(teeMarker)map.removeLayer(teeMarker);
  if(greenMarker)map.removeLayer(greenMarker);
  if(holeLine)map.removeLayer(holeLine);

  const {whiteTee,green}=yardageData[h];
  teeMarker=L.marker([whiteTee.lat,whiteTee.lng],{icon:teeIcon}).addTo(map);
  greenMarker=L.marker([green.lat,green.lng],{icon:greenIcon}).addTo(map);

  holeLine=L.polyline([[whiteTee.lat,whiteTee.lng],[green.lat,green.lng]],{
    color:"#007AFF",weight:4
  }).addTo(map);

  map.fitBounds(holeLine.getBounds(),{padding:[30,30]});

  const d=getDistance(userMarker.getLatLng(),green);
  const yards=Math.round(d*1.09361);
  distanceDisplay.textContent=`Distance: ${yards} yards`;
}

/* ---------- Compass ---------- */
let compassEnabled=false,compassListener=null;

function toggleCompass(){
  compassEnabled?disableCompass():enableCompass();
}

function enableCompass(){
  function start(){
    compassListener=e=>{
      let h=e.webkitCompassHeading??e.alpha;
      if(h==null)return;
      h=(h+360)%360;
      const dirs=["N","NE","E","SE","S","SW","W","NW"];
      const d=dirs[Math.round(h/45)%8];
      headingLabel.style.display="block";
      headingLabel.textContent=`You‚Äôre pointing: ${d} (${Math.round(h)}¬∞)`;
    };
    window.addEventListener("deviceorientation",compassListener,true);
    compassEnabled=true;
    compassStatus.innerHTML="Compass: <span style='color:var(--accent)'>Enabled ‚úì</span>";
  }

  if(DeviceOrientationEvent?.requestPermission){
    DeviceOrientationEvent.requestPermission().then(r=>r==="granted"?start():alert("Compass denied"));
  }else start();
}

function disableCompass(){
  if(compassListener)window.removeEventListener("deviceorientation",compassListener,true);
  compassEnabled=false;
  headingLabel.style.display="none";
  compassStatus.textContent="Compass: Off";
}

/* ---------- Weather ---------- */
fetch("https://api.openweathermap.org/data/2.5/weather?lat=53.387&lon=-2.205&units=metric&appid=e583bd0c194bbfeb3deb92f6bfdad11a")
.then(r=>r.json())
.then(d=>{
  const temp=Math.round(d.main.temp);
  const wind=Math.round(d.wind.speed*2.237);
  const dir=["N","NE","E","SE","S","SW","W","NW"][Math.round(d.wind.deg/45)%8];
  weatherBox.innerHTML=`
    <img src="https://openweathermap.org/img/wn/${d.weather[0].icon}@2x.png">
    <div><strong>Cheadle GC</strong><br>${temp}¬∞C ‚Ä¢ ${d.weather[0].description}<br>Wind: ${wind} mph ${dir}</div>`;
});
</script>

</body>
</html>
