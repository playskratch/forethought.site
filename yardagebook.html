<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>ForeThought — YardageBook JSON Generator</title>
<meta name="description" content="YardageBook generator for Lesson Logger Companion." />

<link rel="stylesheet" href="style.css"/>

<style>
/* ---- YOUR EXISTING STYLES (unchanged) ---- */
:root{
  --bg:#0b0c0f;--card:#12141a;--muted:#8a90a0;--text:#eef0f6;
  --border:rgba(255,255,255,.10);--shadow:0 10px 30px rgba(0,0,0,.35);
  --accent:#2d7dff;--danger:#ff4d4d;--ok:#35c759;
  --mono:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
  --sans:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
}
body{margin:0;font-family:var(--sans);background:var(--bg);color:var(--text)}
.wrap{max-width:980px;margin:0 auto;padding:16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid var(--border)}
th{font-size:12px;color:var(--muted)}
input,textarea{width:100%;padding:8px;border-radius:8px}
button{padding:10px 12px;border-radius:10px}
button.primary{background:var(--accent);color:#fff;border:none}
.btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.mono{font-family:var(--mono)}
.hint{font-size:12px;color:var(--muted)}
.drop{border:1px dashed var(--border);padding:14px;border-radius:14px;text-align:center}
.compat{display:inline-flex;gap:8px;align-items:center;font-size:12px;color:var(--muted)}
.compat .dot{width:8px;height:8px;border-radius:50%;background:var(--ok)}
</style>
</head>

<body>

<header class="wrap">
  <h1>YardageBook JSON Generator</h1>
  <div class="compat"><span class="dot"></span>ForeThought export compatible</div>
</header>

<main class="wrap">
<div class="card">

<label>Clubs</label>
<table>
<thead><tr><th>Club</th><th>Carry</th><th>Total</th><th></th></tr></thead>
<tbody id="clubBody"></tbody>
</table>
<button id="addClub" class="primary">+ Add club</button>

<hr/>

<label>Wedge Matrix</label>
<table>
<thead><tr><th>Wedge</th><th>¼</th><th>½</th><th>¾</th><th>Full</th><th></th></tr></thead>
<tbody id="wedgeBody"></tbody>
</table>
<button id="addWedge">+ Add wedge</button>

<div class="btnRow">
  <button class="primary" id="download">Download JSON</button>
  <button onclick="exportYardagesA6()">Export Yardages (A6)</button>
  <button onclick="exportWedgesA6()">Export Wedges (A6)</button>
</div>

<hr/>

<label>Import existing YardageBook.json</label>
<div class="drop" id="dropZone">
  Drag & drop JSON here or
  <button id="importBtn">Choose file</button>
  <input id="importFile" type="file" accept="application/json" hidden>
</div>

<label>Live JSON</label>
<textarea id="preview" rows="18" class="mono" readonly></textarea>

</div>
</main>

<script>
let state={ clubs:[], wedgeMatrix:[] };

function render(){
  clubBody.innerHTML="";
  state.clubs.forEach((c,i)=>{
    clubBody.innerHTML+=`
      <tr>
        <td><input value="${c.name||""}" oninput="c.name=this.value;sync()"></td>
        <td><input value="${c.carry||""}" oninput="c.carry=+this.value;sync()"></td>
        <td><input value="${c.total||""}" oninput="c.total=+this.value;sync()"></td>
        <td><button onclick="state.clubs.splice(${i},1);render()">✕</button></td>
      </tr>`;
  });

  wedgeBody.innerHTML="";
  state.wedgeMatrix.forEach((w,i)=>{
    wedgeBody.innerHTML+=`
      <tr>
        <td><input value="${w.name||""}" oninput="w.name=this.value;sync()"></td>
        <td><input value="${w.q||""}" oninput="w.q=+this.value;sync()"></td>
        <td><input value="${w.h||""}" oninput="w.h=+this.value;sync()"></td>
        <td><input value="${w.tq||""}" oninput="w.tq=+this.value;sync()"></td>
        <td><input value="${w.f||""}" oninput="w.f=+this.value;sync()"></td>
        <td><button onclick="state.wedgeMatrix.splice(${i},1);render()">✕</button></td>
      </tr>`;
  });

  sync();
}

function buildJSON(){
  const j={
    type:"yardageBook",
    generatedAt:new Date().toISOString(),
    source:"Manual",
    units:"yd",
    clubs:state.clubs.filter(c=>c.name)
  };
  if(state.wedgeMatrix.length){
    j.wedgeMatrix=state.wedgeMatrix.map(w=>({
      name:w.name,
      swings:{quarter:w.q,half:w.h,threeQuarter:w.tq,full:w.f}
    }));
  }
  return j;
}

function sync(){
  preview.value=JSON.stringify(buildJSON(),null,2);
}

addClub.onclick=()=>{ state.clubs.push({}); render(); };
addWedge.onclick=()=>{ state.wedgeMatrix.push({}); render(); };

download.onclick=()=>{
  const b=new Blob([JSON.stringify(buildJSON(),null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="YardageBook.json";
  a.click();
};

/* ---- CORRECT A6 EXPORT ---- */
function openA6(title, tableHTML){
  const w=window.open("","_blank","width=420,height=600");
  w.document.write(`
    <style>
      @page{size:A6;margin:8mm}
      body{font-family:-apple-system;margin:0;color:#000}
      h1{text-align:center;font-size:14px;margin-bottom:6px}
      table{width:100%;border-collapse:collapse}
      th,td{font-size:12px;padding:6px;border-bottom:1px solid #ccc}
    </style>
    <h1>${title}</h1>
    ${tableHTML}
    <script>window.onload=()=>window.print();<\/script>
  `);
  w.document.close();
}

function exportYardagesA6(){
  openA6(
    "Yardages",
    `<table><tr><th>Club</th><th>Carry</th><th>Total</th></tr>
     ${state.clubs.map(c=>`<tr><td>${c.name}</td><td>${c.carry}</td><td>${c.total}</td></tr>`).join("")}
     </table>`
  );
}

function exportWedgesA6(){
  openA6(
    "Wedge Matrix",
    `<table><tr><th>Wedge</th><th>¼</th><th>½</th><th>¾</th><th>Full</th></tr>
     ${state.wedgeMatrix.map(w=>`<tr><td>${w.name}</td><td>${w.q}</td><td>${w.h}</td><td>${w.tq}</td><td>${w.f}</td></tr>`).join("")}
     </table>`
  );
}

/* ---- IMPORT ---- */
importBtn.onclick=()=>importFile.click();
importFile.onchange=async e=>{
  const o=JSON.parse(await e.target.files[0].text());
  state.clubs=o.clubs||[];
  state.wedgeMatrix=(o.wedgeMatrix||[]).map(w=>({
    name:w.name,q:w.swings.quarter,h:w.swings.half,tq:w.swings.threeQuarter,f:w.swings.full
  }));
  render();
};

render();
</script>
</body>
</html>
